<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Breakdown - FilmFolks Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* --- Global Styles --- */
        :root {
            --primary-color: #3b82f6;
            --background-color: #111827;
            --surface-color: #1f2937;
            --text-color: #f3f4f6;
            --border-color: #374151;
            --danger-color: #ef4444;

            /* Category Colors */
            --color-cast: #f59e0b; /* Amber */
            --color-props: #10b981; /* Emerald */
            --color-costumes: #8b5cf6; /* Violet */
            --color-makeup: #ec4899; /* Pink */
            --color-vehicles: #6366f1; /* Indigo */
            --color-sfx: #d946ef; /* Fuchsia */
            --color-sound: #0ea5e9; /* Sky */
            --color-stunts: #f43f5e; /* Rose */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            font-size: 16px;
        }

        /* --- Header & Layout --- */
        .page-header {
            background-color: var(--surface-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
        }
        .page-header h2 { margin: 0; display: flex; align-items: center; gap: 10px; }
        .container { max-width: 1600px; margin: 20px auto; padding: 0 20px; }
        .section { background-color: var(--surface-color); padding: 25px; border-radius: 8px; }

        /* --- Scene Details Form --- */
        .scene-details-form {
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
        }
        .scene-details-form h3 { margin-top: 0; }
        .form-grid-condensed {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            background-color: #374151;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 0.95rem;
            box-sizing: border-box;
            font-family: inherit;
        }
        textarea {
            min-height: 50px;
            resize: vertical;
            margin-bottom: 15px;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        /* --- Breakdown Grid & Categories --- */
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .breakdown-category {
            background-color: var(--background-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            border-top: 4px solid; /* Color applied by JS */
        }
        .breakdown-category h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .add-item-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .add-item-form input {
            flex-grow: 1;
            padding: 8px;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
        }
        .add-item-form button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
        }
        .item-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .tagged-item {
            background-color: var(--surface-color);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
            word-break: break-all;
        }
        .delete-item-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1rem;
            padding-left: 10px;
        }
        .delete-item-btn:hover { color: var(--danger-color); }

        /* --- Mobile Responsiveness --- */
        @media (max-width: 768px) {
            .form-grid-condensed {
                grid-template-columns: 1fr 1fr;
            }
            .breakdown-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <div class="header-left">
            <h2><i class="fas fa-highlighter"></i> Script Breakdown</h2>
        </div>
        <div class="header-right">
            </div>
    </header>

    <div class="container">
        <div class="section" id="breakdown-sheet">
            <div class="scene-details-form">
                <h3>Scene Details</h3>
                <div class="form-grid-condensed">
                    <input type="text" id="scene-number" placeholder="Scene No." required>
                    <select id="scene-type">
                        <option value="INT">INT.</option>
                        <option value="EXT">EXT.</option>
                        <option value="INT/EXT">INT./EXT.</option>
                    </select>
                    <input type="text" id="scene-location" placeholder="Location (e.g., JOE'S CAFE)">
                    <select id="scene-time">
                        <option value="DAY">DAY</option>
                        <option value="NIGHT">NIGHT</option>
                        <option value="DAWN">DAWN</option>
                        <option value="DUSK">DUSK</option>
                    </select>
                </div>
                <textarea id="scene-description" placeholder="Enter a brief one-line description of the scene..."></textarea>
                <button id="save-scene-details-btn" class="btn-primary">Save Scene Details</button>
            </div>

            <div class="breakdown-grid" id="breakdown-grid">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Script Breakdown Initializing...");

            // --- CATEGORY DEFINITIONS ---
            const categories = [
                { key: 'cast', title: 'Cast', icon: 'fa-user-ninja', color: 'var(--color-cast)' },
                { key: 'props', title: 'Props', icon: 'fa-magic-wand-sparkles', color: 'var(--color-props)' },
                { key: 'costumes', title: 'Costumes & Wardrobe', icon: 'fa-shirt', color: 'var(--color-costumes)' },
                { key: 'makeup', title: 'Hair & Makeup', icon: 'fa-palette', color: 'var(--color-makeup)' },
                { key: 'vehicles', title: 'Vehicles', icon: 'fa-car', color: 'var(--color-vehicles)' },
                { key: 'sfx', title: 'Special Effects (SFX)', icon: 'fa-bomb', color: 'var(--color-sfx)' },
                { key: 'sound', title: 'Sound', icon: 'fa-volume-high', color: 'var(--color-sound)' },
                { key: 'stunts', title: 'Stunts', icon: 'fa-bolt', color: 'var(--color-stunts)' },
            ];

            // --- GLOBAL STATE ---
            let breakdownData = {};

            // --- DOM ELEMENTS ---
            const breakdownGrid = document.getElementById('breakdown-grid');
            const saveSceneDetailsBtn = document.getElementById('save-scene-details-btn');

            // --- INITIALIZATION ---
            function initialize() {
                if (!breakdownGrid || !saveSceneDetailsBtn) {
                    console.error("Critical HTML elements are missing. Aborting initialization.");
                    return;
                }
                
                loadBreakdownData();
                categories.forEach(createCategoryUI);
                renderAll();

                saveSceneDetailsBtn.addEventListener('click', saveSceneDetails);
                console.log("Initialization complete. All buttons should be working.");
            }

            // --- UI CREATION ---
            function createCategoryUI(category) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'breakdown-category';
                categoryDiv.id = `category-${category.key}`;
                categoryDiv.style.borderTopColor = category.color;

                categoryDiv.innerHTML = `
                    <h4><i class="fas ${category.icon}"></i> ${category.title}</h4>
                    <form class="add-item-form">
                        <input type="text" placeholder="Add element..." required>
                        <button type="submit">Add</button>
                    </form>
                    <ul class="item-list"></ul>
                `;

                categoryDiv.querySelector('.add-item-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const input = e.target.querySelector('input');
                    const value = input.value.trim();
                    if (value) {
                        addItem(category.key, value);
                        input.value = '';
                    }
                });

                breakdownGrid.appendChild(categoryDiv);
            }

            // --- DATA HANDLING ---
            function addItem(categoryKey, value) {
                if (!breakdownData[categoryKey]) {
                    breakdownData[categoryKey] = [];
                }
                breakdownData[categoryKey].push(value);
                saveBreakdownData();
                renderCategory(categoryKey);
            }

            function deleteItem(categoryKey, index) {
                if (breakdownData[categoryKey] && breakdownData[categoryKey][index] !== undefined) {
                    breakdownData[categoryKey].splice(index, 1);
                    saveBreakdownData();
                    renderCategory(categoryKey);
                }
            }

            function saveSceneDetails() {
                breakdownData.sceneNumber = document.getElementById('scene-number').value;
                breakdownData.sceneType = document.getElementById('scene-type').value;
                breakdownData.sceneLocation = document.getElementById('scene-location').value;
                breakdownData.sceneTime = document.getElementById('scene-time').value;
                breakdownData.sceneDescription = document.getElementById('scene-description').value;
                saveBreakdownData();
                alert('Scene details saved!');
            }

            // --- RENDERING ---
            function renderCategory(categoryKey) {
                const itemList = document.querySelector(`#category-${categoryKey} .item-list`);
                if (!itemList) return;
                itemList.innerHTML = '';

                const items = breakdownData[categoryKey] || [];
                items.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = 'tagged-item';
                    li.innerHTML = `
                        <span></span>
                        <button class="delete-item-btn" title="Delete Item">&times;</button>
                    `;
                    li.querySelector('span').textContent = item; // Use textContent for security
                    li.querySelector('.delete-item-btn').addEventListener('click', () => deleteItem(categoryKey, index));
                    itemList.appendChild(li);
                });
            }

            function renderAll() {
                document.getElementById('scene-number').value = breakdownData.sceneNumber || '';
                document.getElementById('scene-type').value = breakdownData.sceneType || 'INT.';
                document.getElementById('scene-location').value = breakdownData.sceneLocation || '';
                document.getElementById('scene-time').value = breakdownData.sceneTime || 'DAY';
                document.getElementById('scene-description').value = breakdownData.sceneDescription || '';
                categories.forEach(cat => renderCategory(cat.key));
            }

            // --- LOCALSTORAGE PERSISTENCE ---
            function saveBreakdownData() {
                localStorage.setItem('scriptBreakdownData', JSON.stringify(breakdownData));
            }

            function loadBreakdownData() {
                const savedData = localStorage.getItem('scriptBreakdownData');
                if (savedData) {
                    breakdownData = JSON.parse(savedData);
                } else {
                    breakdownData = {};
                    categories.forEach(cat => {
                        breakdownData[cat.key] = [];
                    });
                }
            }

            // --- START THE APP ---
            initialize();
        });
    </script>
</body>
</html>
